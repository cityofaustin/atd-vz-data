# ATD - Toolbox
This is a collection of scripts which have been written to serve a one-time or infrequent purpose. They are not intended to be run in an automated fashion and commonly would be used from the command line when needed. They will each have different parameters and possible environment variables which need to be set for the script to function as intended. 

##### `s3_restore_cr3_pdfs/`
This contains a Python script will take a JSON file of crash ids, and download and check the CR3 file stored in S3 for each crash. It will verify the type of file using the `libmagic` library will restore the most recent `application/pdf` from the S3 version history of the file. 

##### `reposition_crashes_to_centroid_svrd_locations/`
This is a Python script which will use a database view to find the set of crashes which:
* Are on a level 5 centerline,
* Have CR3 data which indicates that the crash occurred on a service road,
* Have a directionality which gives a hint which way off the centerline the crash should be moved.

For these crashes, the script will add 0.00000001 decimal degrees to the latitude of the crash, which is an immaterial movement in geographic terms, but it will cause the lambda function tied to crash-updates to execute. It is this lambda function which will figure out what location to move the crash to and will do so.

##### `download_cr3s.py`
This is a python script which can be used to download CR3 files en masse. 

It requires that two environment variables to be set:
* AWS_ACCESS_KEY_ID
* AWS_SECRET_ACCESS_KEY

These AWS credentials must have access to the S3 bucket `atd-vision-zero-editor`.

The program expects to have a CSV file, with headers, to be piped into `stdin`, which it will parse. It will look for a column named `crash_id`, but it is flexible in the naming, as it will use a regex to detect variations on that name. In particular, the program will accept the CSV generated by the Vision Zero Editor without modification as input. 

The program will collect the unique set of crash IDs from this input and then download the CR3 files from S3 for those files. A directory will be created for each invocation of the program in the form of `./downloaded_files/[TIMESTAMP]`. 